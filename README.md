# Patratskiy Maxim's branch

### Воспоминания от 10.09

##### Сначала про работу карты. 

У нас будет класс WorldMap, который будет хранить трехмерный массив указателей на Units. Трехмерный массив будет разбит на условные блоки. Мы имеем двухмерный массив в каждом элементе которого хранятся массивы указателей. Каждый элемент двумерного массива будем называть чанком, где один чанк будет отвечать за объекты персонажей находящихся в нём. <p>

Обрабатывать объекты движком мы будем те, что лежат в подмассиве размером 5 на 5 чанков с главным героем в центральном чанке. Отрисовывать только один чанк. Также брать объекты на проверку нажатия на них из чанка в котором будет находится главный герой. <p>

Остаётся открытым вопрос о том, как мы будем переносить персонажей из чанка в чанк. Проблема заключается в назначении ответственного за это класс. Была идея сделать LocationController <p>

<p>

##### Теперь про Handler и взаимодействия

Первоначально надо написать класс адаптер для евентов библиотеки SFML. Мы будем использовать евенты нажатия клавиш клавиатуры и мыши sfml, а потом преобразовывать в наши events. <p>

Сейчас мы имеем какое-то представление о том, как будут появляться и обрабатываться эвенты. В главном игровом цикле у всех объектов Units вызывается метод pushEvent(), который по ссылке записывает в контейнер евентов (eventsPriorityQueue) класса Handler. Далее идет обработка этих событий самим обработчиком. В зависимости от того, от кого пришла то или иное событие (событие будет структурой, которая будет хранить такие данные как: от кого пришло событие, его тип, какая-то доп инфа в зависимости от типа). После того, как обработчик обработал событие, он отправляет какие-то данные или "дергает" по указателю за нужные "ниточки" у PlayerController, NPCController, EnvironmentControler, а те в свою очередь дергают за подконтрольные им объекты. Подробнее описано графически взаимодействие (оно в будующем будет перенесено графически на компьтер) в моём блокноте. Фотография данной страницы фото есть в нашей конфе

##### Про доп данные

Мы уже начали думать над тем, что будет лежать в библиотеке math. Там будут написаны типы данных такие как: vector3d, vector2d, hashTable, какое-нибудь дерево. Также реализованы различные алгоритмы поиска, сортировки и тд. <p>

Последующим нашим шагом будет написание файла с таблицами, описывающие свойства различный вещей нашей природы. Таблица с заклинаниями, где должно быть написано сколько маны стоит заклинание и скок урона нанеесет, описание похоже у брони, оружия, баффов и дебаффов (накидываемых, временных и постояных эффектов)


### Воспоминания от 24.09

Из важного, что было обсуждено с Гришей: сколько оценочно будет занимать места в оперативке игра, немного, прям самую малость, про архитектура. <p>
<p>

##### Движок
 Я ему пересказал статью про архитектуру многопоточного движка. Он схватил голову руками и офегевши осел. Он сказал, что это дремучий лес, однако тема крайне интересная. По итогу многопоточность есть смысл подразумевать в процессе разработки, но всё-таки оставить на потом. Из той статьи стоит подчерпнуть полезные элементы такие как: Менеджеры, котороые помогут нам структурировать общение между объектами компонент; далее полезными будут Системы - модульная часть движка. Отрисовку и физику точно с самого начала начинаем описывать как отдельную систему, для того, чтоб по итогу получить модульный игровой движок, в который мы сможем в дальнейшем легко добавлять новые систему/модули. <p>
 <p>

##### Карта
 Крутой момент, который я придумал перед парой - хранение карты. Для начала расскажу, как физически будет храниться карта. Изначально в голове была мысль хранить текстовый файл, в котором каждый символ - отдельный кусок "пола" (далее тайлик). Таким образом мы имеем возможность отрисовывать 256 различных тайликов. Но теперь мы будем кодировать тайлики - 4-мя символами, т.е. 4мя байтами, т.е. одним интом! Первые два спокойно можно пустить на различные текстуры, которых мы сможем позволить 256 * 256 = 65536 штук. Оставшиеся два на различные эффекты, на пример: добавление красного оттенка или красного изображения для имитации крови и тд. А теперь то, что пришло мне в голову совершенно случайно. Мы сможем таким образом эмитировать освещенность участков карты!!! В одном из байтов (далее нужно будет прийти к соглашению, что и как будем кодировать) можно описывать оровень освещенности этой части и просто чутка осветвлять или накидывать маски на тайл, отвечающий за данную локацию.<p>
Про представление данных карты программно, можно узнать в файле worldmap.h. В целом есть класс chunk, в котором хранится vector указателей на Units и двумерный массив intов, которые представляют тайлики. Класс карта хранит двумерный массив чанков.   
